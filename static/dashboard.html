<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>SONG – Dashboard</title>
  <style>
    body {font-family:Arial,sans-serif; margin:1rem;}
    nav a {margin-right:.5rem;}
    section {margin-top:1rem;}
  </style>
</head>
<body>
  <h1>SONG Dashboard</h1>
  <nav>
    <a href="#" id="newComp">Create Component</a>
    <a href="#" id="newPage">Create Page</a>
    <a href="#" id="editJS">Edit JS Snippet</a>
  </nav>

  <section id="content"></section>

  <script>
    const auth = sessionStorage.getItem('auth');
    if (!auth) location.href = '/';

    function api(path, opts={}) {
      opts.headers = Object.assign(opts.headers||{}, {
        'Authorization': `Basic ${auth}`,
        'Content-Type': 'application/json'
      });
      return fetch(path, opts).then(r=>r.json());
    }

    // ---------- Component creator ----------
    document.getElementById('newComp').onclick = async () => {
      const html = prompt('Component inner HTML (e.g. <div>Hello</div>)');
      if (!html) return;
      const js   = prompt('Optional JS (run inside component)', '');
      const res  = await api('/api/components', {
        method:'POST',
        body:JSON.stringify({html, js})
      });
      alert('Created component ID: '+res.id);
    };

    // ---------- Page creator ----------
    document.getElementById('newPage').onclick = async () => {
      const slug = prompt('Page slug (URL part, e.g. home)');
      const title = prompt('Page title');
      const comps = prompt('Comma‑separated component IDs');
      if (!slug) return;
      const compArr = comps ? comps.split(',').map(s=>s.trim()) : [];
      await api('/api/pages', {
        method:'POST',
        body:JSON.stringify({slug, title, components:compArr})
      });
      alert('Page created – visit /pages/'+slug);
    };

    // ---------- JS editor ----------
    document.getElementById('editJS').onclick = async () => {
      const key = prompt('Key for this snippet');
      const code = prompt('JS source code');
      if (!key) return;
      await api('/api/js', {
        method:'POST',
        body:JSON.stringify({key, code})
      });
      alert('Saved. Retrieve at /api/js/'+key);
    };
  </script>
</body>
</html>